unit UfraBet.Registry;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants, 
  FMX.Types, FMX.Graphics, FMX.Controls, FMX.Forms, FMX.Dialogs, FMX.StdCtrls,
  FMX.Controls.Presentation, FMX.Edit, FMX.Objects, FMX.Layouts, FMX.ListBox,
  FMX.ListView.Types, FMX.ListView.Appearances, FMX.ListView.Adapters.Base,
  FMX.ListView,

  UEntity.Matchs;

type
  TfraBetRegistry = class(TFrame)
    Z: TRectangle;
    lytPrincipal: TLayout;
    Image1: TImage;
    lytBotoes: TLayout;
    rectSalvar: TRectangle;
    Label1: TLabel;
    rectVoltar: TRectangle;
    Label2: TLabel;
    lytTimes: TLayout;
    Label3: TLabel;
    rectTimeA: TRectangle;
    rectTimeB: TRectangle;
    edtTimeA: TEdit;
    edtTimeB: TEdit;
    lstPartidas: TListView;
  private
    procedure VoltarTela;
    procedure CarregarMatchs;
    procedure Registrar;
    procedure PreencherMatchs(const aMatch: TMatch);
  public
    constructor Create(aOwner : TComponent); override;
  end;

var
  fraBetRegistry : TfraBetRegistry;

implementation

{$R *.fmx}

uses

  UfraBet,
  UService.Team,
  UService.Match,
  UEntity.Bets,
  UService.Bet,
  UService.User.Authenticated, UService.Intf;

{ TfraBetRegistry }

procedure TfraBetRegistry.CarregarMatchs;
var
  xServiceMatch : IService;
  xMatch: TMatch;
begin
  lstPartidas.Items.Clear;

  xServiceMatch := TServiceMatch.Create;
  xServiceMatch.Listar;
  for xMatch in TServiceMatch(xServiceMatch).Matchs do
    Self.PreencherMatchs(xMatch);
end;

constructor TfraBetRegistry.Create(aOwner: TComponent);
begin
  inherited Create(aOwner);
  Self.CarregarMatchs;
end;

procedure TfraBetRegistry.PreencherMatchs(const aMatch: TMatch);
var
  xItem : TListViewItem;
const
  PARTIDA = '%s X %s - %s às %s';
begin
  xItem := lstPartidas.Items.Add;
  xItem.Tag := aMatch.Id;

  TListItemText(xItem.Objects.FindDrawable('txtPartida')).Text :=
    Format(PARTIDA,[
      aMatch.TeamA.Name,
      aMatch.TeamB.Name,
      DateToStr(aMatch.Date),
      TimeToStr(aMatch.Hour)
    ])
end;

procedure TfraBetRegistry.Registrar;
var
  xServiceBet : IService;
  xBet: TBet;
  xMatch: TMatch;
  xUserAuthenticated : TUserAuthenticated;
begin
  if lstPartidas.ItemIndex < 0 then
    raise Exception.Create('Selecione uma partida');

  if Trim(edtTimeA.Text) = EmptyStr then
    raise Exception.Create('Informe o placar do time A');

end;

procedure TfraBetRegistry.VoltarTela;
begin

end;

end.
